{% extends 'base.html' %} {% block content %}

<div class="layout d-flex flex-column min-vh-100">
    <!-- Add navbar -->
    {% include "layouts/navbar.html" %}
    <div class="bg-light flex-grow-1">
        <div class="container-xl">
            <div class="row">
                <main class="col seccion px-4 py-3">
                    {% if error_message %}
                    <p><strong>{{ error_message }}</strong></p>
                    {% endif %} {% if form.subject.errors %}
                    <ol>
                      {% for error in form.subject.errors %}
                      <li><strong>{{ error|escape }}</strong></li>
                      {% endfor %}
                    </ol>
                    {% endif %} 

                    <!-- <h2 style="margin-bottom: 0">
                        Bienvenido profesor_name
                    </h2> -->


                    {% if asignatura %}
                    <div class="d-flex justify-content-between mb-3">
                      <div class="p-2"><span>Asignaturas / {{ asignatura.nombre_materia }}</span></div>

                      <div class="p-2">
                        <a
                        href="{% url 'planificaciones:papelera' asignatura.id %}"
                        class="icon-delete"
                        style="text-decoration: none; color: #116ACC; display: flex; align-items: center; "
                        >
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#116ACC" class="bi bi-trash3-fill" viewBox="0 0 16 16" style="margin-right: 4px;">
                          <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5Zm-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5ZM4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06Zm6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528ZM8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5Z"/>
                        </svg>
                          Papelera
                        </a>
                      </div>
                    </div>
                    

                  

                    <form id="nueva-planificacion-form" action="{% url 'planificaciones:nueva' asignatura.id %}" method="post">
                      {% csrf_token %} {{ form }}
                    </form>


                    {% if planificaciones %}
                      <div class="row mt-4">
                        <div class="col-md-4" onclick="document.getElementById('nueva-planificacion-form').submit()" style="cursor: pointer;">
                          <div class="card card-subject p-0 mb-5">
                            <div class="p-3 text-center">
                              <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" fill="#116ACC" class="bi bi-plus-lg" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>
                              </svg>
                            </div>
                            <div class="card-footer p-2 m-0">                                
                                <p class="m-0">Crear planificación vacia</p>
                            </div>
                          </div>
                        </div>
                        
                        {% for planificacion in planificaciones %}
                          <div class="col-md-4">
                            <div class="card card-subject p-0 mb-5">
                              <a
                              href="{% url 'planificaciones:datosDescriptivos' planificacion.id %}"
                              style="text-decoration: none"
                              >
                              <div class="planif-state-card float-right {% if planificacion.estado == "A" %} planif-state-card--aprobado {% endif %}">
                                <p>{{ planificacion.get_estado_display }}</p>
                              </div>

                              <div class="dropdown">
                                  <button
                                      type="button"
                                      id="dropdownMenu2"
                                      data-toggle="dropdown"
                                      aria-haspopup="true"
                                      aria-expanded="false"
                                      class="three-dots-button"
                                  >
                                    <svg data-target="#modal-delete" xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="#D9DDE7" class="bi bi-three-dots" viewBox="0 0 16 16">
                                      <path d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"/>
                                    </svg>
                                  </button>
                                <ul class="dropdown-menu options-menu" aria-labelledby="dropdownMenu2">
                                  <li><button  data-toggle="modal" data-target="#modal-delete">Eliminar</button></li>
                                  <li><form
                                    method="POST"
                                    action="{% url 'planificaciones:aprobarPlanif' planificacion.id %}"><button type="submit">Aprobar planificación</button>{% csrf_token %}</form></li>
                                </ul>
                              </div>  


                              <div class="p-3 pt-2">
                                <h5 class="card-subject-title">
                                    {{ planificacion.asignatura.nombre_materia }} - {{ planificacion.fecha_creacion.year }}
                                </h5>
                                <p class="card-subject-subtitle mb-2 text-muted">
                                    <b>Ultima modificación:</b> {{ planificacion.fecha_modificacion.date }}
                                </p>
                              </div>
                                {% if planificacion.estado == "A" %}
                                  <form
                                  method="POST"  class="card-footer" action="{% url 'planificaciones:copiarPlanif' planificacion.id %}">
                                      <button 
                                      style="appearance: none; background:transparent; border:0; width: 100%; height: 100%; cursor: pointer;"
                                       type="submit">
                                       <p class="m-0">Tomar como base para nueva planificación</p>
                                      </button>
                                      {% csrf_token %}
                                  </form>
                                  {% else %}
                                  <div class="card-footer p-2 m-0"><p class="m-0">Ir a la planificación</p></div>
                                  {% endif %}
                               
                              </a>

                            </div>


                            <!-- MODAL ELIMINAR PLANIFICACION -->
                            <div
                                class="modal fade"
                                id="modal-delete"
                                tabindex="-1"
                                role="dialog"
                                aria-labelledby="exampleModalLabel"
                                aria-hidden="true"
                            >
                                <div class="modal-dialog modal-lg" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="exampleModalLabel">
                                                Eliminar planificación
                                            </h5>
                                            <button
                                                type="button"
                                                class="btn-close"
                                                data-dismiss="modal"
                                                aria-label="Close"
                                            ></button>
                                        </div>
                                        <div class="modal-body">
                                          <form
                                            method="POST"
                                            action="{% url 'planificaciones:deleteLogicPlanificacion' planificacion.id %}"

                                          >
                                            {% csrf_token %}
                                              <p>Estás por eliminar la planificación:</p>
                                              <ul>
                                                <li>Materia: {{ planificacion.asignatura.nombre_materia }}</li>
                                                <li>Año: {{ planificacion.fecha_creacion.year }}</li>
                                                <li>Ultima modificación: {{ planificacion.fecha_modificacion.date }}</li>
                                              </ul>

                                              {% if form.errors %}
                                              <div class="alert alert-danger">{{form.errors}}</div>
                                              {% endif %}

                                              <div class="modal-footer">
                                                  <button
                                                      type="button"
                                                      class="btn btn-outline-primary"
                                                      data-dismiss="modal"
                                                  >
                                                      Cancelar
                                                  </button>
                                                  <button
                                                      id="delete-button"
                                                      type="submit"
                                                      class="btn btn-danger my-4"
                                                  >
                                                      Eliminar
                                                  </button>
                                              </div>
                                          </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                          </div>
                        {% endfor %}
                      </div>
                    {% else %}
                    <p>No se encontraron planificaciones.</p>
                    {% endif %}

                    {% else %}
                    <h2>No existe la asignatura.</h2>
                    {% endif %} 
                </main>
                <aside
                    class="layout__sidebar col-3 py-3 px-2 show collapse aside-calendario"
                > 
                  <div class="container-card-calendario">
                      <div style="text-align: center;">
                          <h5 class="p-2">Calendario</h5>
                      </div>

                      {% if calendario %}
                        {% for fecha in calendario %}
                          <div class="calendario-card">
                            <div class="calendario-card-dot-day">
                              {% if fecha.fecha.day < 10 %}
                                <span class="calendario-card-dot-day-text">0{{ fecha.fecha.day }}</span>
                              {% else %}
                                <span class="calendario-card-dot-day-text">{{ fecha.fecha.day }}</span>
                              {% endif %}
                            </div>
                            <div>
                              <p class="calendario-card-title">{{fecha.get_actividad_display}}</p>
                              {% if fecha.hay_clase %}
                                <p class="calendario-card-subtitle">Sin suspensión de clases</p>
                              {% else %}
                                <p class="calendario-card-subtitle">Con suspensión de clases</p>
                              {% endif %}
                            </div>
                          </div>
                        {% endfor %}
                      {% endif %}
                  </div>
                </aside>
                
            </div>
        </div>
    </div>
</div>

{% endblock %}
