{% if correcciones %}
<div class="pt-4">
    <h2 class="seccion__encabezado">Observaciones</h2>
  </div>

  {% for correccion in correcciones %}
  <div class="seccion__card correccion">
    {% if correccion.creador == request.user %}
        <form enctype="multipart/form-data" method="POST" action="{% url 'planificaciones:cerrarCorreccion' correccion.id %}">
          {% csrf_token %}
          <div class="d-flex justify-content-end">
            {% if correccion.estado == 'R' %}
            <button type="submit" disabled class="btn btn-info btn-sm me-2">Resuelta por {{correccion.usuarioQueResolvio.first_name}} {{correccion.usuarioQueResolvio.last_name}}</button>
            {% endif %}
            {% if correccion.estado != 'C' %}
            <button type="submit" class="btn btn-outline-success btn-sm">Cerrar</button>
            {% else %}
            {% if correccion.usuarioQueResolvio %}
            <button type="submit" disabled class="btn btn-info btn-sm me-2">Resuelta por {{correccion.usuarioQueResolvio.first_name}} {{correccion.usuarioQueResolvio.last_name}}</button>
            {% endif %}
            <button type="submit" disabled class="btn btn-success btn-sm">Cerrada</button>
            {% endif %}
          </div>
          
          <li class="correccion__body mb-0 mt-1">
            {{ correccion.creador.first_name|default:""}} {{ correccion.creador.last_name|default:""}} :
          </li>
          <li class="correccion__body mb-0 mt-0" style="font-size:0.7rem; color:grey">
            {{ correccion.fechaDeCreacion|date:"d/m/Y" }}
          </li>
          <li class="correccion__body mt-1">
            {{ correccion.correccion|default:""}}
          </li>
        </form>
      {% else %}
        <form enctype="multipart/form-data" method="POST" action="{% url 'planificaciones:resolverCorreccion' correccion.id %}">
          {% csrf_token %}
          <div class="d-flex justify-content-end">
            {% if correccion.estado == 'G' %}
            <button type="submit" class="btn btn-outline-info btn-sm">Resolver</button>
            {% else %}
              <button type="submit" disabled class="btn btn-info btn-sm me-1">Resuelta por {{correccion.usuarioQueResolvio.first_name}} {{correccion.usuarioQueResolvio.last_name}}</button>
            {% endif %}
            {% if correccion.estado == 'C' %}
              <button type="submit" disabled class="btn btn-success btn-sm">Cerrada</button>
            {% endif %}
          </div>
          <li class="correccion__body mb-0 mt-1">
            {{ correccion.creador.first_name|default:""}} {{ correccion.creador.last_name|default:""}} :
          </li>
          <li class="correccion__body mb-0 mt-0" style="font-size:0.7rem; color:grey">
            {{ correccion.fechaDeCreacion|date:"d/m/Y" }}
          </li>
          <li class="correccion__body mt-1">
            {{ correccion.correccion|default:""}}
          </li>
        </form>
      {% endif %}

      {% if correccion.comentarios.all %}
      <div class="correccion__comentarios">
          {% for comentario in correccion.comentarios.all %}
              <li>
                <p class="mb-0 mt-1">{{ correccion.creador.first_name|default:""}} {{ correccion.creador.last_name|default:""}} :</p>
                <p class="mb-0" style="font-size:0.7rem; color:grey">{{ correccion.fechaDeCreacion|date:"d/m/Y" }}</p>
                <p class="mb-0 mt-1">{{ comentario.comentario|default:""}}</p>
                {% if not forloop.last %}
                    <hr class="m-1" />
                {% endif %}
              </li>
            
          {% endfor %}   
      </div>     
          {% endif %}
      
        <button type="button" class="correccion__comentarios__add btn btn btn-outline-primary" data-toggle="modal" data-target="#modal-agregar-comentario-{{correccion.id}}">Añadir comentario</button>
    
        <div class="modal fade" id="modal-agregar-comentario-{{correccion.id}}" tabindex="-1" role="dialog" aria-labelledby="labelAgregarComentario" aria-hidden="true">
          <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="labelAgregarComentario">Añadir Comentario</h5>
                <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form method="POST" action="{% url 'planificaciones:agrergarComentario' correccion.id seccion %}">
                  {% csrf_token %}
                  
                  <input type="hidden" name="form_name" value="agregar-comentario" class="form-control" />
                  
                  <label>Descripción</label>
                  <p>{{comentario_form.comentario}}</p>
                  
                  <div class="modal-footer">
                    <button type="button" class="btn btn-outline-primary" data-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>

      </div>
  {% endfor %} 
{% endif %}

<div class="py-4">
<h2 class="seccion__encabezado">Añadir observación</h2>
    <div class="modal-body">
        <form method="POST" 
        {% block action %}
            action="{% url 'planificaciones:agregarCorreccion' planificacion.id seccion %}"
        {% endblock action %}>
        {% csrf_token %}
        <input type="hidden" name="form_name" value="agregar-correccion" class="form-control" />

        <label>Descripción</label>
        <p>{{correccion_form.correccion}}</p>

        <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Añadir observación</button>
        </div>
        </form>
    </div>
</div>